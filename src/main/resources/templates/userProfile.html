<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${userProfile.name} + '의 프로필'">User Profile</title>
    <style>
        .hidden {
            display: none;
        }

        .active {
            font-weight: bold;
        }
    </style>
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>
<div class="user-info">
    <img th:if="${userProfile.profileImg}" th:src="${userProfile.profileImg}" alt="Profile Image" style="width:100px;height:100px;">
    <h1 th:text="${userProfile.name}">User Name</h1>
    <p th:text="${userProfile.userId}">User ID</p>
</div>

<div class="tabs">
    <a href="#" onclick="showContent('posts')" id="postsTab"
       th:classappend="${currentPage == 'posts' ? 'active' : ''}">Posts</a>
    <a href="#" onclick="showContent('series')" id="seriesTab" th:classappend="${currentPage == 'series' ? 'active' : ''}">Series</a>
    <a href="#" onclick="showContent('about')" id="aboutTab"
       th:classappend="${currentPage == 'about' ? 'active' : ''}">About</a>
</div>

<div id="postsContainer" th:classappend="${currentPage == 'posts' ? '' : 'hidden'}">
    <div th:if="${#lists.isEmpty(userProfile.posts)}">
        <p>No posts available.</p>
    </div>

    <!-- 태그 정보 표시 -->
    <div class="tags-container">
        <h3>태그</h3>
        <a href="#" onclick="showAllPosts()">전체보기 (<span th:text="${#lists.size(userProfile.posts)}"></span>)</a>
        <th:block th:each="tag : ${userProfile.tags}">
            <a href="#" th:data-tag="${tag.name}" onclick="showPostsByTag(this.getAttribute('data-tag'))">
                <span th:text="${tag.name}"></span> (<span th:text="${tag.count}"></span>)
            </a>
        </th:block>
    </div>

    <!-- 게시글 목록 -->
    <div th:if="${not #lists.isEmpty(userProfile.posts)}" class="posts-container">
        <div th:each="post : ${userProfile.posts}" class="post">
            <img th:if="${post.thumbnailUrl}" th:src="${post.thumbnailUrl}" alt="Thumbnail">
            <h2 th:text="${post.title}">Post Title</h2>
            <p th:text="${post.context}">Post Context</p>
            <div class="post-tags">
                <span th:each="tag : ${post.tags}" class="tag" th:text="${tag}"></span>
            </div>
            <p th:text="${#temporals.format(post.creationDate, 'yyyy-MM-dd HH:mm')}">Creation Date</p>
            <p th:text="${userProfile.name}"></p>
            <button class="read-more-btn"
                    th:data-author-name="${userProfile.name}"
                    th:data-post-title="${post.title}">
                Read More
            </button>
            <p th:text="${post.isPrivate ? '비공개' : '공개'}">Visibility</p>
        </div>
    </div>
</div>

<div id="seriesContainer" th:classappend="${currentPage == 'series' ? '' : 'hidden'}">
    <div th:if="${#lists.isEmpty(userProfile.series)}">
        <p>No series available.</p>
    </div>

    <div th:if="${not #lists.isEmpty(userProfile.series)}" class="series-container">
        <div th:each="series : ${userProfile.series}" class="series">
            <h2 th:text="${series.name}">Series Name</h2>
            <p th:text="${#lists.size(series.posts)} + '개의 포스트'">Post Count</p>
            <p th:if="${not #lists.isEmpty(series.posts)}"
               th:text="'마지막 업데이트: ' + ${#temporals.format(series.posts[0].creationDate, 'yyyy-MM-dd HH:mm')}">
                Last Update Date
            </p>
        </div>
    </div>
</div>

<div id="aboutContainer" th:classappend="${currentPage == 'about' ? '' : 'hidden'}">
    <h2>About Me</h2>
    <p th:text="${userProfile.aboutMe}">About Me content</p>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // 이벤트 위임을 사용하여 동적으로 생성된 버튼에도 이벤트 리스너를 적용
        $(document).on('click', '.read-more-btn', function() {
            var authorName = $(this).data('authorName');
            var postTitle = $(this).data('postTitle');
            console.log(authorName, postTitle);
            window.location.href = '/vlog.io/@' + authorName + '/' + postTitle;
        });
    });

    function showContent(contentType) {
        const containers = ['postsContainer', 'seriesContainer', 'aboutContainer'];
        const tabs = ['postsTab', 'seriesTab', 'aboutTab'];

        containers.forEach(container => {
            document.getElementById(container).classList.add('hidden');
        });

        tabs.forEach(tab => {
            document.getElementById(tab).classList.remove('active');
        });

        document.getElementById(contentType + 'Container').classList.remove('hidden');
        document.getElementById(contentType + 'Tab').classList.add('active');
    }

    function showAllPosts() {
        document.querySelectorAll('.post').forEach(post => post.style.display = 'block');
    }

    function showPostsByTag(tagName) {
        document.querySelectorAll('.post').forEach(post => {
            const hasTag = Array.from(post.querySelectorAll('.tag')).some(tag => tag.textContent.trim() === tagName);
            post.style.display = hasTag ? 'block' : 'none';
        });
    }
</script>
</body>
</html>
